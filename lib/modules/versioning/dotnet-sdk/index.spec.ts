import dotnetSdk from '.';

describe('modules/versioning/dotnet-sdk/index', () => {
  describe('isSingleVersion()', () => {
    it.each`
      input                  | expected
      ${'8'}                 | ${false}
      ${'8.x'}               | ${false}
      ${'8.0'}               | ${false}
      ${'8.0.x'}             | ${false}
      ${'8.0.1xx'}           | ${false}
      ${'8.0.3xx'}           | ${false}
      ${'8.0.321'}           | ${true}
      ${'8.0.100-preview.1'} | ${true}
      ${'foobar'}            | ${false}
    `('isSingleVersion("$input") === $expected', ({ input, expected }) => {
      expect(dotnetSdk.isSingleVersion(input)).toBe(expected);
    });
  });

  describe('isStable()', () => {
    it.each`
      input                           | expected
      ${'9'}                          | ${true}
      ${'9.x'}                        | ${true}
      ${'9.0'}                        | ${true}
      ${'9.0.x'}                      | ${true}
      ${'9.0.x'}                      | ${true}
      ${'9.0.1xx'}                    | ${true}
      ${'9.0.4xx'}                    | ${true}
      ${'9.0.100'}                    | ${true}
      ${'9.0.304'}                    | ${true}
      ${'9.0.100-preview.7.24407.12'} | ${false}
      ${'9.0.100-rc.2.24474.11'}      | ${false}
      ${'10'}                         | ${true}
      ${'10.x'}                       | ${true}
      ${'10.0'}                       | ${true}
      ${'10.0.x'}                     | ${true}
      ${'10.0.1xx'}                   | ${true}
      ${'10.0.4xx'}                   | ${true}
      ${'10.0.100'}                   | ${true}
      ${'10.0.0-preview.6.25358.103'} | ${false}
      ${'10.0.100-rc.2.25359.11'}     | ${false}
    `('isStable("$input") === $expected', ({ input, expected }) => {
      expect(dotnetSdk.isStable(input)).toBe(expected);
    });
  });

  describe('isValid()', () => {
    it.each`
      input                                | expected
      ${'2'}                               | ${true}
      ${'2.0'}                             | ${true}
      ${'2.x'}                             | ${true}
      ${'2.0.0'}                           | ${true}
      ${'2.0.x'}                           | ${true}
      ${'2.0.100'}                         | ${true}
      ${'2.0.1xx'}                         | ${true}
      ${'2.0.0.0'}                         | ${false}
      ${'9.0.3'}                           | ${true}
      ${'1.2019.3.22'}                     | ${false}
      ${'3.0.0-beta'}                      | ${true}
      ${'2.0.2-pre20191018090318'}         | ${true}
      ${'1.0.0+c30d7625'}                  | ${false}
      ${'2.3.4-beta+1990ef74'}             | ${false}
      ${'17.04'}                           | ${true}
      ${'3.0.0.beta'}                      | ${false}
      ${'5.1.2-+'}                         | ${false}
      ${'1--'}                             | ${false}
      ${'1.0.0+*'}                         | ${false}
      ${'1.0.**'}                          | ${false}
      ${'1.*.0'}                           | ${false}
      ${'1.0.*-*bla'}                      | ${false}
      ${'1.0.*-*bla+*'}                    | ${false}
      ${'**'}                              | ${false}
      ${'1.0.0-preview.*+blabla'}          | ${false}
      ${'1.0.*--'}                         | ${false}
      ${'1.0.*-alpha*+'}                   | ${false}
      ${'1.0.*-'}                          | ${false}
      ${null}                              | ${false}
      ${''}                                | ${false}
      ${'1.0.0-preview.1'}                 | ${true}
      ${'1.0.*-bla*'}                      | ${false}
      ${'1.0.*-*'}                         | ${false}
      ${'1.0.*-preview.1.*'}               | ${false}
      ${'1.0.*-preview.1*'}                | ${false}
      ${'1.0.0--'}                         | ${false}
      ${'1.0.0-bla*'}                      | ${false}
      ${'1.0.*--*'}                        | ${false}
      ${'1.0.0--*'}                        | ${false}
      ${'1.0.0+*'}                         | ${false}
      ${'1.0.**'}                          | ${false}
      ${'1.*.0'}                           | ${false}
      ${'1.0.*-*bla'}                      | ${false}
      ${'1.0.*-*bla+*'}                    | ${false}
      ${'**'}                              | ${false}
      ${'1.0.0-preview.*+blabla'}          | ${false}
      ${'1.0.*--'}                         | ${false}
      ${'1.0.*-alpha*+'}                   | ${false}
      ${'1.0.*-'}                          | ${false}
      ${'1.0.0-preview.1'}                 | ${true}
      ${'1.0.*-bla*'}                      | ${false}
      ${'1.0.*-*'}                         | ${false}
      ${'1.0.*-preview.1.*'}               | ${false}
      ${'1.0.*-preview.1*'}                | ${false}
      ${'1.0.0--'}                         | ${false}
      ${'1.0.0-bla1'}                      | ${true}
      ${'1.0.*--*'}                        | ${false}
      ${'1.0.0--*'}                        | ${false}
      ${'1.0.0.*-*'}                       | ${false}
      ${'1.0.*-*'}                         | ${false}
      ${'1.*-*'}                           | ${false}
      ${'*-rc.*'}                          | ${false}
      ${'*-*'}                             | ${false}
      ${'1.0.0-Beta'}                      | ${true}
      ${'1.0.0-Beta.2'}                    | ${true}
      ${'1.0.0+MetaOnly'}                  | ${false}
      ${'1.0.0'}                           | ${true}
      ${'1.0.0-Beta+Meta'}                 | ${false}
      ${'1.0.0-RC.X+MetaAA'}               | ${false}
      ${'1.0.0-RC.X.35.A.3455+Meta-A-B-C'} | ${false}
    `('isValid("$input") === $expected', ({ input, expected }) => {
      expect(dotnetSdk.isValid(input)).toBe(expected);
      expect(dotnetSdk.isCompatible(input)).toBe(expected);
    });
  });

  describe('isVersion()', () => {
    it.each`
      input                             | expected
      ${'9'}                            | ${true}
      ${'9.0'}                          | ${true}
      ${'9.x'}                          | ${false}
      ${'9.0.3'}                        | ${true}
      ${'9.0.x'}                        | ${false}
      ${'9.0.300'}                      | ${true}
      ${'9.0.3xx'}                      | ${false}
      ${'10'}                           | ${true}
      ${'10.0'}                         | ${true}
      ${'10.x'}                         | ${false}
      ${'10.0.x'}                       | ${false}
      ${'10.0.100'}                     | ${true}
      ${'10.0.1xx'}                     | ${false}
      ${'10.0.100-preview.6.25358.103'} | ${true}
      ${'10.0.100.preview.6.25358.103'} | ${false}
      ${null}                           | ${false}
      ${undefined}                      | ${false}
      ${''}                             | ${false}
      ${' '}                            | ${false}
      ${'1beta'}                        | ${false}
      ${'1.2..'}                        | ${false}
      ${'foo'}                          | ${false}
    `('isVersion("$input") === $expected', ({ input, expected }) => {
      expect(dotnetSdk.isVersion(input)).toBe(expected);
    });
  });

  describe('getMajor, getMinor, getPatch', () => {
    it.each`
      input                           | major         | minor         | patch
      ${''}                           | ${null}       | ${null}       | ${null}
      ${null}                         | ${null}       | ${null}       | ${null}
      ${undefined}                    | ${null}       | ${null}       | ${null}
      ${'1'}                          | ${1}          | ${null}       | ${null}
      ${'1.2'}                        | ${1}          | ${2}          | ${null}
      ${'1.2.3'}                      | ${1}          | ${2}          | ${3}
      ${'10.2.3'}                     | ${10}         | ${2}          | ${3}
      ${'   19'}                      | ${19}         | ${null}       | ${null}
      ${'   19.   19'}                | ${19}         | ${19}         | ${null}
      ${'   19.   19.   19'}          | ${19}         | ${19}         | ${19}
      ${'19   '}                      | ${19}         | ${null}       | ${null}
      ${'19   .19   '}                | ${19}         | ${19}         | ${null}
      ${'19   .19   .19   '}          | ${19}         | ${19}         | ${19}
      ${'   19   '}                   | ${19}         | ${null}       | ${null}
      ${'   19   .   19   '}          | ${19}         | ${19}         | ${null}
      ${'   19   .   19   .   19   '} | ${19}         | ${19}         | ${19}
      ${'01.1.1'}                     | ${1}          | ${1}          | ${1}
      ${'1.01.1'}                     | ${1}          | ${1}          | ${1}
      ${'1.1.01'}                     | ${1}          | ${1}          | ${1}
      ${'2147483647.1.1'}             | ${2147483647} | ${1}          | ${1}
      ${'1.2147483647.1'}             | ${1}          | ${2147483647} | ${1}
      ${'1.1.2147483647'}             | ${1}          | ${1}          | ${2147483647}
    `(
      '$input -> [$major, $minor, $patch]',
      ({ input, major, minor, patch }) => {
        expect(dotnetSdk.getMajor(input)).toBe(major);
        expect(dotnetSdk.getMinor(input)).toBe(minor);
        expect(dotnetSdk.getPatch(input)).toBe(patch);
      },
    );
  });

  describe('equals()', () => {
    it.each`
      a                                 | b                                 | expected
      ${'8'}                            | ${'8'}                            | ${true}
      ${'8'}                            | ${'9'}                            | ${false}
      ${'8'}                            | ${'8.0'}                          | ${true}
      ${'8.0'}                          | ${'8'}                            | ${true}
      ${'8.0'}                          | ${'8.0'}                          | ${true}
      ${'8.0'}                          | ${'8.1'}                          | ${false}
      ${'8.0'}                          | ${'8.0.100'}                      | ${true}
      ${'8.0.100'}                      | ${'8.0'}                          | ${true}
      ${'8.0.0'}                        | ${'8.0.1'}                        | ${false}
      ${'8.0.1'}                        | ${'8.0.0'}                        | ${false}
      ${'8.0.1'}                        | ${'8.0.1'}                        | ${true}
      ${'8.0.1'}                        | ${'8.0.2'}                        | ${false}
      ${'8.0.100'}                      | ${'8.0.100'}                      | ${true}
      ${'8.0.100'}                      | ${'8.0.101'}                      | ${false}
      ${'8.0.100'}                      | ${'8.0.200'}                      | ${false}
      ${'10'}                           | ${'10'}                           | ${true}
      ${'10'}                           | ${'11'}                           | ${false}
      ${'10'}                           | ${'10.0'}                         | ${true}
      ${'10.0'}                         | ${'10'}                           | ${true}
      ${'10.0'}                         | ${'10.0'}                         | ${true}
      ${'10.0'}                         | ${'10.1'}                         | ${false}
      ${'10.0'}                         | ${'10.0.100'}                     | ${true}
      ${'10.0.100'}                     | ${'10.0'}                         | ${true}
      ${'10.0.0'}                       | ${'10.0.1'}                       | ${false}
      ${'10.0.1'}                       | ${'10.0.0'}                       | ${false}
      ${'10.0.1'}                       | ${'10.0.1'}                       | ${true}
      ${'10.0.1'}                       | ${'10.0.2'}                       | ${false}
      ${'10.0.100'}                     | ${'10.0.100'}                     | ${true}
      ${'10.0.100'}                     | ${'10.0.101'}                     | ${false}
      ${'10.0.100'}                     | ${'10.0.200'}                     | ${false}
      ${'10.0.0-preview.5.25277.114'}   | ${'10.0.100-preview.6.25358.103'} | ${false}
      ${'10.0.100-preview.6.25358.103'} | ${'10.0.100-preview.6.25358.103'} | ${true}
    `('equals($a, $b) === $expected', ({ a, b, expected }) => {
      expect(dotnetSdk.equals(a, b)).toBe(expected);
    });
  });

  describe('isGreaterThan()', () => {
    it.each`
      a                                 | b                                 | expected
      ${'8.0.101'}                      | ${'8.0.100'}                      | ${true}
      ${'8.0.100'}                      | ${'8.0.100'}                      | ${false}
      ${'8.0.100'}                      | ${'8.0.101'}                      | ${false}
      ${'9.0.100-preview.7.24406.2'}    | ${'9.0.100-preview.7.24406.2'}    | ${false}
      ${'9.0.100-preview.6.24328.4'}    | ${'9.0.100-preview.7.24406.2'}    | ${false}
      ${'9.0.100-preview.7.24406.2'}    | ${'9.0.100-preview.6.24328.4'}    | ${true}
      ${'9.0.100-rc.1.24452.1'}         | ${'9.0.100-preview.7.24406.2'}    | ${true}
      ${'9.0.100'}                      | ${'9.0.100-rc.1.24452.1'}         | ${true}
      ${'10.0.100-preview.6.25358.103'} | ${'10.0.100-preview.5.25277.114'} | ${true}
      ${'10.0.100-preview.5.25277.114'} | ${'10.0.100-preview.6.25358.103'} | ${false}
      ${'10.0.100-preview.6.25358.103'} | ${'10.0.100-preview.6.25358.103'} | ${false}
      ${'10.0.100'}                     | ${'10.0.100-preview.6.25358.103'} | ${true}
    `('isGreaterThan($a, $b) === $expected', ({ a, b, expected }) => {
      expect(dotnetSdk.isGreaterThan(a, b)).toBe(expected);
    });
  });

  describe('isLessThanRange()', () => {
    it.each`
      version      | range        | expected
      ${'foo'}     | ${'bar'}     | ${false}
      ${'1'}       | ${'bar'}     | ${false}
      ${'foo'}     | ${'1'}       | ${false}
      ${'1'}       | ${'1'}       | ${false}
      ${'8'}       | ${'8'}       | ${false}
      ${'8'}       | ${'9'}       | ${true}
      ${'9'}       | ${'8'}       | ${false}
      ${'8'}       | ${'8.x'}     | ${false}
      ${'8'}       | ${'9.x'}     | ${true}
      ${'9'}       | ${'8.x'}     | ${false}
      ${'8.0'}     | ${'8.0'}     | ${false}
      ${'8.0'}     | ${'8.1'}     | ${true}
      ${'8.1'}     | ${'8.0'}     | ${false}
      ${'8'}       | ${'8.0.x'}   | ${false}
      ${'8'}       | ${'9.0.x'}   | ${true}
      ${'9'}       | ${'8.0.x'}   | ${false}
      ${'8.0.100'} | ${'8.0.1xx'} | ${false}
      ${'8.0.100'} | ${'8.0.2xx'} | ${true}
      ${'9.0.100'} | ${'8.0.1xx'} | ${false}
    `(
      'isLessThanRange("$version", "$range") === $expected',
      ({ version, range, expected }) => {
        expect(dotnetSdk.isLessThanRange?.(version, range)).toBe(expected);
      },
    );
  });

  describe('getSatisfyingVersion()', () => {
    it.each`
      versions                                                                                              | range        | expected
      ${[]}                                                                                                 | ${'8.0.x'}   | ${null}
      ${['foobar']}                                                                                         | ${'8.0.x'}   | ${null}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'foobar'}  | ${null}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'8'}       | ${'8.0.413'}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'8.x'}     | ${'8.0.413'}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'8.0'}     | ${'8.0.413'}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'8.0.x'}   | ${'8.0.413'}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'8.0.1xx'} | ${'8.0.101'}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'8.0.2xx'} | ${null}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'8.0.3xx'} | ${null}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'8.0.4xx'} | ${'8.0.413'}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'9'}       | ${'9.0.304'}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'9.x'}     | ${'9.0.304'}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'9.0'}     | ${'9.0.304'}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'9.0.x'}   | ${'9.0.304'}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'9.0.1xx'} | ${'9.0.100'}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'9.0.2xx'} | ${null}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'9.0.3xx'} | ${'9.0.304'}
    `(
      'getSatisfyingVersion($versions, $range) === "$expected"',
      ({ versions, range, expected }) => {
        expect(dotnetSdk.getSatisfyingVersion(versions, range)).toBe(expected);
      },
    );
  });

  describe('minSatisfyingVersion()', () => {
    it.each`
      versions                                                                                              | range         | expected
      ${[]}                                                                                                 | ${'8.0.x'}    | ${null}
      ${['foobar']}                                                                                         | ${'8.0.x'}    | ${null}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'8'}        | ${'8.0.100'}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'8.x'}      | ${'8.0.100'}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'8.0'}      | ${'8.0.100'}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'8.0.x'}    | ${'8.0.100'}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'8.0.1xx'}  | ${'8.0.100'}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'8.0.4xx'}  | ${'8.0.400'}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'9'}        | ${'9.0.100'}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'9.x'}      | ${'9.0.100'}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'9.0'}      | ${'9.0.100'}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'9.0.x'}    | ${'9.0.100'}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'9.0.1xx'}  | ${'9.0.100'}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'9.0.3xx'}  | ${'9.0.304'}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'10'}       | ${'10.0.100-preview.6.25358.103'}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'10.x'}     | ${'10.0.100-preview.6.25358.103'}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'10.0'}     | ${'10.0.100-preview.6.25358.103'}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'10.0.x'}   | ${'10.0.100-preview.6.25358.103'}
      ${['8.0.100', '8.0.101', '8.0.400', '8.0.413', '9.0.100', '9.0.304', '10.0.100-preview.6.25358.103']} | ${'10.0.1xx'} | ${'10.0.100-preview.6.25358.103'}
    `(
      'minSatisfyingVersion($versions, $range) === $expected',
      ({ versions, range, expected }) => {
        expect(dotnetSdk.minSatisfyingVersion(versions, range)).toBe(expected);
      },
    );
  });

  describe('getNewValue()', () => {
    it('returns newVersion if the range is version too', () => {
      expect(
        dotnetSdk.getNewValue({
          rangeStrategy: 'replace',
          currentValue: '9.0.100',
          newVersion: '9.0.101',
        }),
      ).toBe('9.0.101');
    });

    it('returns null if version is invalid', () => {
      expect(
        dotnetSdk.getNewValue({
          rangeStrategy: 'replace',
          currentValue: '9.0.x',
          newVersion: 'foobar',
        }),
      ).toBeNull();
    });

    it('returns null if range is invalid', () => {
      expect(
        dotnetSdk.getNewValue({
          rangeStrategy: 'replace',
          currentValue: 'foobar',
          newVersion: '9.0.101',
        }),
      ).toBeNull();
    });

    describe('pin', () => {
      it('returns the new version', () => {
        expect(
          dotnetSdk.getNewValue({
            rangeStrategy: 'pin',
            currentValue: '9.0.x',
            newVersion: '9.0.304',
          }),
        ).toBe('9.0.304');
      });
    });

    describe('bump', () => {
      it.each`
        currentValue | newVersion   | expected
        ${'8'}       | ${'8.0.101'} | ${'8'}
        ${'8.x'}     | ${'8.0.101'} | ${'8.x'}
        ${'8.0'}     | ${'8.0.101'} | ${'8.0'}
        ${'8.0.x'}   | ${'8.0.101'} | ${'8.0.x'}
        ${'8.0.1xx'} | ${'8.0.101'} | ${'8.0.1xx'}
        ${'8.0.1xx'} | ${'8.0.200'} | ${'8.0.2xx'}
        ${'8.0.1xx'} | ${'9.0.100'} | ${'9.0.1xx'}
        ${'8.0.2xx'} | ${'9.0.100'} | ${'9.0.1xx'}
        ${'8.0.1xx'} | ${'9.0.300'} | ${'9.0.3xx'}
        ${'8.0.100'} | ${'8.0.101'} | ${'8.0.101'}
        ${'8.0.100'} | ${'8.0.200'} | ${'8.0.200'}
        ${'8.0.200'} | ${'9.0.100'} | ${'9.0.100'}
        ${'8'}       | ${'9.0.101'} | ${'9'}
        ${'8.x'}     | ${'9.0.101'} | ${'9.x'}
        ${'8.0'}     | ${'9.0.101'} | ${'9.0'}
        ${'8.0.x'}   | ${'9.0.101'} | ${'9.0.x'}
        ${'8.0.1xx'} | ${'9.0.101'} | ${'9.0.1xx'}
        ${'8.0.1xx'} | ${'9.0.200'} | ${'9.0.2xx'}
        ${'8.0.100'} | ${'9.0.101'} | ${'9.0.101'}
        ${'8.0.100'} | ${'9.0.200'} | ${'9.0.200'}
      `(
        'currentValue=$currentValue newVersion=$newVersion -> $expected',
        ({ currentValue, newVersion, expected }) => {
          expect(
            dotnetSdk.getNewValue({
              rangeStrategy: 'bump',
              currentValue,
              newVersion,
            }),
          ).toBe(expected);
        },
      );
    });
  });

  describe('sortVersions', () => {
    it.each`
      a          | b          | expected
      ${'1'}     | ${'1'}     | ${0}
      ${'9'}     | ${'10'}    | ${-1}
      ${'10'}    | ${'9'}     | ${1}
      ${'9'}     | ${'9'}     | ${0}
      ${'10'}    | ${'10'}    | ${0}
      ${'1'}     | ${'2'}     | ${-1}
      ${'2'}     | ${'1'}     | ${1}
      ${'0.1'}   | ${'0.1'}   | ${0}
      ${'0.1'}   | ${'0.2'}   | ${-1}
      ${'0.2'}   | ${'0.1'}   | ${1}
      ${'0.0.1'} | ${'0.0.1'} | ${0}
      ${'0.0.1'} | ${'0.0.2'} | ${-1}
      ${'0.0.2'} | ${'0.0.1'} | ${1}
      ${'1-abc'} | ${'1-ABC'} | ${0}
      ${'1-ABC'} | ${'1-abc'} | ${0}
      ${'1-abc'} | ${'1-xyz'} | ${-1}
      ${'1-xyz'} | ${'1-abc'} | ${1}
      ${'foo'}   | ${'bar'}   | ${0}
    `('sortVersions($a, $b) === $expected', ({ a, b, expected }) => {
      expect(dotnetSdk.sortVersions(a, b)).toBe(expected);
    });
  });

  describe('matches()', () => {
    it.each`
      version                           | range         | expected
      ${'foo'}                          | ${'8'}        | ${false}
      ${'8'}                            | ${'foo'}      | ${false}
      ${'7'}                            | ${'8'}        | ${false}
      ${'8'}                            | ${'8'}        | ${true}
      ${'9'}                            | ${'8'}        | ${false}
      ${'8'}                            | ${'8.x'}      | ${true}
      ${'8'}                            | ${'8.0'}      | ${true}
      ${'8.0'}                          | ${'8.0.x'}    | ${true}
      ${'8.0.100'}                      | ${'8.0.1xx'}  | ${true}
      ${'8.0.123'}                      | ${'8.0.1xx'}  | ${true}
      ${'8.0.200'}                      | ${'8.0.1xx'}  | ${false}
      ${'8.0.200'}                      | ${'8.0.2xx'}  | ${true}
      ${'8.0.200'}                      | ${'8.0.3xx'}  | ${false}
      ${'8.0.1000'}                     | ${'8.0.1xx'}  | ${false}
      ${'10.0.100-preview.6.25358.103'} | ${'10'}       | ${true}
      ${'10.0.100-preview.6.25358.103'} | ${'10.x'}     | ${true}
      ${'10.0.100-preview.6.25358.103'} | ${'10.0'}     | ${true}
      ${'10.0.100-preview.6.25358.103'} | ${'10.0.x'}   | ${true}
      ${'10.0.100-preview.6.25358.103'} | ${'10.0.1xx'} | ${true}
    `(
      'matches("$version", "$range") === $expected',
      ({ version, range, expected }) => {
        expect(dotnetSdk.matches(version, range)).toBe(expected);
      },
    );
  });
});
