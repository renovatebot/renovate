// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`modules/platform/bitbucket-server/index endpoint with no path addAssignees() does not throw 1`] = `undefined`;

exports[`modules/platform/bitbucket-server/index endpoint with no path addReviewers does not throw 1`] = `undefined`;

exports[`modules/platform/bitbucket-server/index endpoint with no path addReviewers does not throw 2`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "body": Object {
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "userName2",
          },
        },
        Object {
          "user": Object {
            "name": "name",
          },
        },
      ],
      "title": "title",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "98",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path addReviewers sends the reviewer name as a reviewer 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "body": Object {
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "userName2",
          },
        },
        Object {
          "user": Object {
            "name": "name",
          },
        },
      ],
      "title": "title",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "98",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path addReviewers throws 1`] = `"Response code 405 (Method Not Allowed)"`;

exports[`modules/platform/bitbucket-server/index endpoint with no path addReviewers throws 2`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "body": Object {
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "userName2",
          },
        },
        Object {
          "user": Object {
            "name": "name",
          },
        },
      ],
      "title": "title",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "98",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path addReviewers throws not-found 1 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path addReviewers throws not-found 2 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/4",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path addReviewers throws not-found 3 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "body": Object {
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "userName2",
          },
        },
        Object {
          "user": Object {
            "name": "name",
          },
        },
      ],
      "title": "title",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "98",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path addReviewers throws on invalid reviewers 1`] = `"Response code 409 (Conflict)"`;

exports[`modules/platform/bitbucket-server/index endpoint with no path addReviewers throws on invalid reviewers 2`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "body": Object {
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "userName2",
          },
        },
        Object {
          "user": Object {
            "name": "name",
          },
        },
      ],
      "title": "title",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "98",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path addReviewers throws repository-changed 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "body": Object {
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "userName2",
          },
        },
        Object {
          "user": Object {
            "name": "name",
          },
        },
      ],
      "title": "title",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "98",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path createPr() posts PR 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/default-reviewers/1.0/projects/SOME/repos/repo/reviewers?sourceRefId=refs/heads/branch&targetRefId=refs/heads/master&sourceRepoId=5&targetRepoId=5",
  },
  Object {
    "body": Object {
      "description": "body",
      "fromRef": Object {
        "id": "refs/heads/branch",
      },
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "jcitizen",
          },
        },
      ],
      "title": "title",
      "toRef": Object {
        "id": "refs/heads/master",
      },
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "153",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path createPr() posts PR default branch 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/default-reviewers/1.0/projects/SOME/repos/repo/reviewers?sourceRefId=refs/heads/branch&targetRefId=refs/heads/master&sourceRepoId=5&targetRepoId=5",
  },
  Object {
    "body": Object {
      "description": "body",
      "fromRef": Object {
        "id": "refs/heads/branch",
      },
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "jcitizen",
          },
        },
      ],
      "title": "title",
      "toRef": Object {
        "id": "refs/heads/master",
      },
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "153",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path deleteLAbel() does not throw 1`] = `undefined`;

exports[`modules/platform/bitbucket-server/index endpoint with no path ensureComment() add comment if not found 1 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100&start=1",
  },
  Object {
    "body": Object {
      "text": "### topic

content",
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "31",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/comments",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path ensureComment() add comment if not found 2 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100&start=1",
  },
  Object {
    "body": Object {
      "text": "content",
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "18",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/comments",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path ensureComment() add updates comment if necessary 1 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100&start=1",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/comments/21",
  },
  Object {
    "body": Object {
      "text": "### some-subject

some
content",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "56",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/comments/21",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path ensureComment() add updates comment if necessary 2 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100&start=1",
  },
  Object {
    "body": Object {
      "text": "some
content",
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "24",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/comments",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path ensureComment() does not throw 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/undefined/repos/undefined/pull-requests/3/activities?limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path ensureComment() skips comment 1 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100&start=1",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path ensureComment() skips comment 2 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100&start=1",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path ensureCommentRemoval() deletes comment by content if found 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100&start=1",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/comments/22",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "DELETE",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/comments/22?version=1",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path ensureCommentRemoval() deletes comment by topic if found 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100&start=1",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/comments/21",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "DELETE",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/comments/21?version=1",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path ensureCommentRemoval() deletes nothing 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100&start=1",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path ensureCommentRemoval() does not throw 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/undefined/repos/undefined/pull-requests/5/activities?limit=100",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/undefined/repos/undefined/pull-requests/5/activities?limit=100&start=1",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path findPr() has no pr 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests?state=ALL&role.1=AUTHOR&username.1=abc&limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path findPr() has pr 1`] = `
Object {
  "body": "* Line 1
* Line 2",
  "createdAt": 1547853840016,
  "number": 5,
  "sourceBranch": "userName1/pullRequest5",
  "state": "open",
  "targetBranch": "master",
  "title": "title",
  "version": 1,
}
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path findPr() has pr 2`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests?state=ALL&role.1=AUTHOR&username.1=abc&limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getBranchPr() has no pr 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests?state=ALL&role.1=AUTHOR&username.1=abc&limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getBranchPr() has pr 1`] = `
Object {
  "body": "* Line 1
* Line 2",
  "createdAt": 1547853840016,
  "displayNumber": "Pull Request #5",
  "hasReviewers": true,
  "number": 5,
  "reviewers": Array [
    "userName2",
  ],
  "sourceBranch": "userName1/pullRequest5",
  "state": "open",
  "targetBranch": "master",
  "title": "title",
  "version": 1,
}
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getBranchPr() has pr 2`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests?state=ALL&role.1=AUTHOR&username.1=abc&limit=100",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getBranchStatus() should be failed 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/build-status/1.0/commits/stats/0d9c7726c3d628b7e28af234595cfd20febdbf8e",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/build-status/1.0/commits/stats/0d9c7726c3d628b7e28af234595cfd20febdbf8e",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getBranchStatus() should be pending 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/build-status/1.0/commits/stats/0d9c7726c3d628b7e28af234595cfd20febdbf8e",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/build-status/1.0/commits/stats/0d9c7726c3d628b7e28af234595cfd20febdbf8e",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getBranchStatus() should be success 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/build-status/1.0/commits/stats/0d9c7726c3d628b7e28af234595cfd20febdbf8e",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getBranchStatus() throws repository-changed 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getBranchStatusCheck() should be failure 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getBranchStatusCheck() should be null 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getBranchStatusCheck() should be pending 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getBranchStatusCheck() should be success 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getJsonFile() returns file content 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/browse/file.json?limit=20000",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getJsonFile() returns file content from branch or tag 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/browse/file.json?limit=20000&at=dev",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getJsonFile() returns file content from given repo 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/DIFFERENT/repos/repo/browse/file.json?limit=20000",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getJsonFile() returns file content in json5 format 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/browse/file.json5?limit=20000",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getJsonFile() throws on errors 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/browse/file.json?limit=20000",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getJsonFile() throws on long content 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/browse/file.json?limit=20000",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getJsonFile() throws on malformed JSON 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/browse/file.json?limit=20000",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getPr() canRebase 1`] = `
Object {
  "body": "* Line 1
* Line 2",
  "createdAt": 1547853840016,
  "displayNumber": "Pull Request #5",
  "hasReviewers": true,
  "number": 5,
  "reviewers": Array [
    "userName2",
  ],
  "sourceBranch": "userName1/pullRequest5",
  "state": "open",
  "targetBranch": "master",
  "title": "title",
  "version": 1,
}
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getPr() canRebase 2`] = `
Object {
  "body": "* Line 1
* Line 2",
  "createdAt": 1547853840016,
  "displayNumber": "Pull Request #5",
  "hasReviewers": true,
  "number": 5,
  "reviewers": Array [
    "userName2",
  ],
  "sourceBranch": "userName1/pullRequest5",
  "state": "open",
  "targetBranch": "master",
  "title": "title",
  "version": 1,
}
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getPr() canRebase 3`] = `
Object {
  "body": "* Line 1
* Line 2",
  "createdAt": 1547853840016,
  "displayNumber": "Pull Request #5",
  "hasReviewers": true,
  "number": 5,
  "reviewers": Array [
    "userName2",
  ],
  "sourceBranch": "userName1/pullRequest5",
  "state": "open",
  "targetBranch": "master",
  "title": "title",
  "version": 1,
}
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getPr() canRebase 4`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/3",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getPr() gets a PR 1`] = `
Object {
  "body": "* Line 1
* Line 2",
  "createdAt": 1547853840016,
  "displayNumber": "Pull Request #5",
  "hasReviewers": true,
  "number": 5,
  "reviewers": Array [
    "userName2",
  ],
  "sourceBranch": "userName1/pullRequest5",
  "state": "open",
  "targetBranch": "master",
  "title": "title",
  "version": 1,
}
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getPr() gets a PR 2`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getPr() gets a closed PR 1`] = `
Object {
  "body": undefined,
  "createdAt": undefined,
  "displayNumber": "Pull Request #undefined",
  "hasReviewers": false,
  "number": undefined,
  "reviewers": Array [],
  "sourceBranch": undefined,
  "state": "merged",
  "targetBranch": undefined,
  "title": undefined,
  "version": 0,
}
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getPr() gets a closed PR 2`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getPr() returns null for no prNo 1`] = `Array []`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getPrList() has pr 1`] = `
Array [
  Object {
    "body": "* Line 1
* Line 2",
    "createdAt": 1547853840016,
    "number": 5,
    "sourceBranch": "userName1/pullRequest5",
    "state": "open",
    "targetBranch": "master",
    "title": "title",
    "version": 1,
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getPrList() has pr 2`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests?state=ALL&role.1=AUTHOR&username.1=abc&limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path getRepos() returns repos 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/repos?permission=REPO_WRITE&state=AVAILABLE&limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path initPlatform() should init 1`] = `
Object {
  "endpoint": "https://stash.renovatebot.com/",
}
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path initRepo() generates URL if API does not contain clone links 1`] = `
Object {
  "defaultBranch": "master",
  "isFork": false,
}
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path initRepo() generates URL if API does not contain clone links 2`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path initRepo() throws REPOSITORY_EMPTY if there is no default branch 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path initRepo() uses http url from API with injected auth if http url in API response 1`] = `
Object {
  "defaultBranch": "master",
  "isFork": false,
}
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path initRepo() uses http url from API with injected auth if http url in API response 2`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path initRepo() uses ssh url from API if http not in API response 1`] = `
Object {
  "defaultBranch": "master",
  "isFork": false,
}
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path initRepo() uses ssh url from API if http not in API response 2`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path initRepo() works 1`] = `
Object {
  "defaultBranch": "master",
  "isFork": false,
}
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path initRepo() works 2`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path massageMarkdown() returns diff files 1`] = `"**foo**bartext"`;

exports[`modules/platform/bitbucket-server/index endpoint with no path massageMarkdown() sanitizes HTML comments in the body 1`] = `
"---

- [ ] If you want to rebase/retry this PR, click this checkbox
- [ ] <a href=\\"/some/link\\">Update renovate/renovate to 16.1.2</a>

---

Empty comment.

Followed by some information.
"
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path mergePr() posts Merge 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/merge?version=1",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path mergePr() throws conflicted 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/merge?version=1",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path mergePr() throws not-found 1 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path mergePr() throws not-found 2 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/4",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path mergePr() throws not-found 3 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/merge?version=1",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path mergePr() unknown error 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/merge?version=1",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path repoForceRebase() return false if ff strategy is enabled 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/undefined/repos/undefined/settings/pull-requests",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path repoForceRebase() return false if no-ff strategy is enabled 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/undefined/repos/undefined/settings/pull-requests",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path repoForceRebase() return false if rebase-no-ff strategy is enabled 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/undefined/repos/undefined/settings/pull-requests",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path repoForceRebase() return false if squash strategy is enabled 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/undefined/repos/undefined/settings/pull-requests",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path repoForceRebase() return true if ff-only strategy is enabled 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/undefined/repos/undefined/settings/pull-requests",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path repoForceRebase() return true if rebase-ff-only strategy is enabled 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/undefined/repos/undefined/settings/pull-requests",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path repoForceRebase() return true if squash-ff-only strategy is enabled 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/undefined/repos/undefined/settings/pull-requests",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path repoForceRebase() returns false on missing defaultStrategy 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/undefined/repos/undefined/settings/pull-requests",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path repoForceRebase() returns false on missing mergeConfig 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/undefined/repos/undefined/settings/pull-requests",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path setBranchStatus() should be success 1 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
  Object {
    "body": Object {
      "description": null,
      "key": "context-2",
      "state": "SUCCESSFUL",
      "url": "https://renovatebot.com",
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "91",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/build-status/1.0/commits/stats/0d9c7726c3d628b7e28af234595cfd20febdbf8e",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path setBranchStatus() should be success 2 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
  Object {
    "body": Object {
      "description": null,
      "key": "context-2",
      "state": "FAILED",
      "url": "https://renovatebot.com",
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "87",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/build-status/1.0/commits/stats/0d9c7726c3d628b7e28af234595cfd20febdbf8e",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path setBranchStatus() should be success 3 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
  Object {
    "body": Object {
      "description": null,
      "key": "context-2",
      "state": "FAILED",
      "url": "https://renovatebot.com",
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "87",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/build-status/1.0/commits/stats/0d9c7726c3d628b7e28af234595cfd20febdbf8e",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path setBranchStatus() should be success 4 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
  Object {
    "body": Object {
      "description": null,
      "key": "context-2",
      "state": "INPROGRESS",
      "url": "https://renovatebot.com",
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "91",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/build-status/1.0/commits/stats/0d9c7726c3d628b7e28af234595cfd20febdbf8e",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path setBranchStatus() should be success 5 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
  Object {
    "body": Object {
      "description": null,
      "key": "context-2",
      "state": "SUCCESSFUL",
      "url": "https://renovatebot.com",
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "91",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path setBranchStatus() should be success 6 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path updatePr() closes PR 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "body": Object {
      "description": "body",
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "userName2",
          },
        },
      ],
      "title": "title",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "94",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/decline?version=42",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path updatePr() handles invalid users gracefully by retrying without invalid reviewers 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "body": Object {
      "description": "body",
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "userName2",
          },
        },
      ],
      "title": "title",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "94",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "body": Object {
      "description": "body",
      "reviewers": Array [],
      "title": "title",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "65",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path updatePr() puts PR 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "body": Object {
      "description": "body",
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "userName2",
          },
        },
      ],
      "title": "title",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "94",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path updatePr() re-opens PR 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "body": Object {
      "description": "body",
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "userName2",
          },
        },
      ],
      "title": "title",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "94",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/reopen?version=42",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path updatePr() throws 1`] = `"Response code 405 (Method Not Allowed)"`;

exports[`modules/platform/bitbucket-server/index endpoint with no path updatePr() throws 2`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "body": Object {
      "description": "body",
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "userName2",
          },
        },
      ],
      "title": "title",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "94",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path updatePr() throws not-found 1 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path updatePr() throws not-found 2 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/4",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path updatePr() throws not-found 3 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "body": Object {
      "description": "body",
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "userName2",
          },
        },
      ],
      "title": "title",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "94",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with no path updatePr() throws repository-changed 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "body": Object {
      "description": "body",
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "userName2",
          },
        },
      ],
      "title": "title",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "94",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path addAssignees() does not throw 1`] = `undefined`;

exports[`modules/platform/bitbucket-server/index endpoint with path addReviewers does not throw 1`] = `undefined`;

exports[`modules/platform/bitbucket-server/index endpoint with path addReviewers does not throw 2`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "body": Object {
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "userName2",
          },
        },
        Object {
          "user": Object {
            "name": "name",
          },
        },
      ],
      "title": "title",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "98",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path addReviewers sends the reviewer name as a reviewer 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "body": Object {
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "userName2",
          },
        },
        Object {
          "user": Object {
            "name": "name",
          },
        },
      ],
      "title": "title",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "98",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path addReviewers throws 1`] = `"Response code 405 (Method Not Allowed)"`;

exports[`modules/platform/bitbucket-server/index endpoint with path addReviewers throws 2`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "body": Object {
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "userName2",
          },
        },
        Object {
          "user": Object {
            "name": "name",
          },
        },
      ],
      "title": "title",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "98",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path addReviewers throws not-found 1 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path addReviewers throws not-found 2 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/4",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path addReviewers throws not-found 3 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "body": Object {
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "userName2",
          },
        },
        Object {
          "user": Object {
            "name": "name",
          },
        },
      ],
      "title": "title",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "98",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path addReviewers throws on invalid reviewers 1`] = `"Response code 409 (Conflict)"`;

exports[`modules/platform/bitbucket-server/index endpoint with path addReviewers throws on invalid reviewers 2`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "body": Object {
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "userName2",
          },
        },
        Object {
          "user": Object {
            "name": "name",
          },
        },
      ],
      "title": "title",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "98",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path addReviewers throws repository-changed 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "body": Object {
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "userName2",
          },
        },
        Object {
          "user": Object {
            "name": "name",
          },
        },
      ],
      "title": "title",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "98",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path createPr() posts PR 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/default-reviewers/1.0/projects/SOME/repos/repo/reviewers?sourceRefId=refs/heads/branch&targetRefId=refs/heads/master&sourceRepoId=5&targetRepoId=5",
  },
  Object {
    "body": Object {
      "description": "body",
      "fromRef": Object {
        "id": "refs/heads/branch",
      },
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "jcitizen",
          },
        },
      ],
      "title": "title",
      "toRef": Object {
        "id": "refs/heads/master",
      },
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "153",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path createPr() posts PR default branch 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/default-reviewers/1.0/projects/SOME/repos/repo/reviewers?sourceRefId=refs/heads/branch&targetRefId=refs/heads/master&sourceRepoId=5&targetRepoId=5",
  },
  Object {
    "body": Object {
      "description": "body",
      "fromRef": Object {
        "id": "refs/heads/branch",
      },
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "jcitizen",
          },
        },
      ],
      "title": "title",
      "toRef": Object {
        "id": "refs/heads/master",
      },
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "153",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path deleteLAbel() does not throw 1`] = `undefined`;

exports[`modules/platform/bitbucket-server/index endpoint with path ensureComment() add comment if not found 1 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100&start=1",
  },
  Object {
    "body": Object {
      "text": "### topic

content",
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "31",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/comments",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path ensureComment() add comment if not found 2 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100&start=1",
  },
  Object {
    "body": Object {
      "text": "content",
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "18",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/comments",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path ensureComment() add updates comment if necessary 1 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100&start=1",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/comments/21",
  },
  Object {
    "body": Object {
      "text": "### some-subject

some
content",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "56",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/comments/21",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path ensureComment() add updates comment if necessary 2 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100&start=1",
  },
  Object {
    "body": Object {
      "text": "some
content",
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "24",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/comments",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path ensureComment() does not throw 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/undefined/repos/undefined/pull-requests/3/activities?limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path ensureComment() skips comment 1 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100&start=1",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path ensureComment() skips comment 2 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100&start=1",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path ensureCommentRemoval() deletes comment by content if found 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100&start=1",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/comments/22",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "DELETE",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/comments/22?version=1",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path ensureCommentRemoval() deletes comment by topic if found 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100&start=1",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/comments/21",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "DELETE",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/comments/21?version=1",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path ensureCommentRemoval() deletes nothing 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/activities?limit=100&start=1",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path ensureCommentRemoval() does not throw 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/undefined/repos/undefined/pull-requests/5/activities?limit=100",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/undefined/repos/undefined/pull-requests/5/activities?limit=100&start=1",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path findPr() has no pr 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests?state=ALL&role.1=AUTHOR&username.1=abc&limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path findPr() has pr 1`] = `
Object {
  "body": "* Line 1
* Line 2",
  "createdAt": 1547853840016,
  "number": 5,
  "sourceBranch": "userName1/pullRequest5",
  "state": "open",
  "targetBranch": "master",
  "title": "title",
  "version": 1,
}
`;

exports[`modules/platform/bitbucket-server/index endpoint with path findPr() has pr 2`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests?state=ALL&role.1=AUTHOR&username.1=abc&limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path getBranchPr() has no pr 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests?state=ALL&role.1=AUTHOR&username.1=abc&limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path getBranchPr() has pr 1`] = `
Object {
  "body": "* Line 1
* Line 2",
  "createdAt": 1547853840016,
  "displayNumber": "Pull Request #5",
  "hasReviewers": true,
  "number": 5,
  "reviewers": Array [
    "userName2",
  ],
  "sourceBranch": "userName1/pullRequest5",
  "state": "open",
  "targetBranch": "master",
  "title": "title",
  "version": 1,
}
`;

exports[`modules/platform/bitbucket-server/index endpoint with path getBranchPr() has pr 2`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests?state=ALL&role.1=AUTHOR&username.1=abc&limit=100",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path getBranchStatus() should be failed 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/build-status/1.0/commits/stats/0d9c7726c3d628b7e28af234595cfd20febdbf8e",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/build-status/1.0/commits/stats/0d9c7726c3d628b7e28af234595cfd20febdbf8e",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path getBranchStatus() should be pending 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/build-status/1.0/commits/stats/0d9c7726c3d628b7e28af234595cfd20febdbf8e",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/build-status/1.0/commits/stats/0d9c7726c3d628b7e28af234595cfd20febdbf8e",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path getBranchStatus() should be success 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/build-status/1.0/commits/stats/0d9c7726c3d628b7e28af234595cfd20febdbf8e",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path getBranchStatus() throws repository-changed 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path getBranchStatusCheck() should be failure 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path getBranchStatusCheck() should be null 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path getBranchStatusCheck() should be pending 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path getBranchStatusCheck() should be success 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path getJsonFile() returns file content 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/browse/file.json?limit=20000",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path getJsonFile() returns file content from branch or tag 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/browse/file.json?limit=20000&at=dev",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path getJsonFile() returns file content from given repo 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/DIFFERENT/repos/repo/browse/file.json?limit=20000",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path getJsonFile() returns file content in json5 format 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/browse/file.json5?limit=20000",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path getJsonFile() throws on errors 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/browse/file.json?limit=20000",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path getJsonFile() throws on long content 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/browse/file.json?limit=20000",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path getJsonFile() throws on malformed JSON 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/browse/file.json?limit=20000",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path getPr() canRebase 1`] = `
Object {
  "body": "* Line 1
* Line 2",
  "createdAt": 1547853840016,
  "displayNumber": "Pull Request #5",
  "hasReviewers": true,
  "number": 5,
  "reviewers": Array [
    "userName2",
  ],
  "sourceBranch": "userName1/pullRequest5",
  "state": "open",
  "targetBranch": "master",
  "title": "title",
  "version": 1,
}
`;

exports[`modules/platform/bitbucket-server/index endpoint with path getPr() canRebase 2`] = `
Object {
  "body": "* Line 1
* Line 2",
  "createdAt": 1547853840016,
  "displayNumber": "Pull Request #5",
  "hasReviewers": true,
  "number": 5,
  "reviewers": Array [
    "userName2",
  ],
  "sourceBranch": "userName1/pullRequest5",
  "state": "open",
  "targetBranch": "master",
  "title": "title",
  "version": 1,
}
`;

exports[`modules/platform/bitbucket-server/index endpoint with path getPr() canRebase 3`] = `
Object {
  "body": "* Line 1
* Line 2",
  "createdAt": 1547853840016,
  "displayNumber": "Pull Request #5",
  "hasReviewers": true,
  "number": 5,
  "reviewers": Array [
    "userName2",
  ],
  "sourceBranch": "userName1/pullRequest5",
  "state": "open",
  "targetBranch": "master",
  "title": "title",
  "version": 1,
}
`;

exports[`modules/platform/bitbucket-server/index endpoint with path getPr() canRebase 4`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/3",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path getPr() gets a PR 1`] = `
Object {
  "body": "* Line 1
* Line 2",
  "createdAt": 1547853840016,
  "displayNumber": "Pull Request #5",
  "hasReviewers": true,
  "number": 5,
  "reviewers": Array [
    "userName2",
  ],
  "sourceBranch": "userName1/pullRequest5",
  "state": "open",
  "targetBranch": "master",
  "title": "title",
  "version": 1,
}
`;

exports[`modules/platform/bitbucket-server/index endpoint with path getPr() gets a PR 2`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path getPr() gets a closed PR 1`] = `
Object {
  "body": undefined,
  "createdAt": undefined,
  "displayNumber": "Pull Request #undefined",
  "hasReviewers": false,
  "number": undefined,
  "reviewers": Array [],
  "sourceBranch": undefined,
  "state": "merged",
  "targetBranch": undefined,
  "title": undefined,
  "version": 0,
}
`;

exports[`modules/platform/bitbucket-server/index endpoint with path getPr() gets a closed PR 2`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path getPr() returns null for no prNo 1`] = `Array []`;

exports[`modules/platform/bitbucket-server/index endpoint with path getPrList() has pr 1`] = `
Array [
  Object {
    "body": "* Line 1
* Line 2",
    "createdAt": 1547853840016,
    "number": 5,
    "sourceBranch": "userName1/pullRequest5",
    "state": "open",
    "targetBranch": "master",
    "title": "title",
    "version": 1,
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path getPrList() has pr 2`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests?state=ALL&role.1=AUTHOR&username.1=abc&limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path getRepos() returns repos 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/repos?permission=REPO_WRITE&state=AVAILABLE&limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path initPlatform() should init 1`] = `
Object {
  "endpoint": "https://stash.renovatebot.com/",
}
`;

exports[`modules/platform/bitbucket-server/index endpoint with path initRepo() generates URL if API does not contain clone links 1`] = `
Object {
  "defaultBranch": "master",
  "isFork": false,
}
`;

exports[`modules/platform/bitbucket-server/index endpoint with path initRepo() generates URL if API does not contain clone links 2`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path initRepo() throws REPOSITORY_EMPTY if there is no default branch 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path initRepo() uses http url from API with injected auth if http url in API response 1`] = `
Object {
  "defaultBranch": "master",
  "isFork": false,
}
`;

exports[`modules/platform/bitbucket-server/index endpoint with path initRepo() uses http url from API with injected auth if http url in API response 2`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path initRepo() uses ssh url from API if http not in API response 1`] = `
Object {
  "defaultBranch": "master",
  "isFork": false,
}
`;

exports[`modules/platform/bitbucket-server/index endpoint with path initRepo() uses ssh url from API if http not in API response 2`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path initRepo() works 1`] = `
Object {
  "defaultBranch": "master",
  "isFork": false,
}
`;

exports[`modules/platform/bitbucket-server/index endpoint with path initRepo() works 2`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path massageMarkdown() returns diff files 1`] = `"**foo**bartext"`;

exports[`modules/platform/bitbucket-server/index endpoint with path massageMarkdown() sanitizes HTML comments in the body 1`] = `
"---

- [ ] If you want to rebase/retry this PR, click this checkbox
- [ ] <a href=\\"/some/link\\">Update renovate/renovate to 16.1.2</a>

---

Empty comment.

Followed by some information.
"
`;

exports[`modules/platform/bitbucket-server/index endpoint with path mergePr() posts Merge 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/merge?version=1",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path mergePr() throws conflicted 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/merge?version=1",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path mergePr() throws not-found 1 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path mergePr() throws not-found 2 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/4",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path mergePr() throws not-found 3 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/merge?version=1",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path mergePr() unknown error 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/merge?version=1",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path repoForceRebase() return false if ff strategy is enabled 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/undefined/repos/undefined/settings/pull-requests",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path repoForceRebase() return false if no-ff strategy is enabled 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/undefined/repos/undefined/settings/pull-requests",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path repoForceRebase() return false if rebase-no-ff strategy is enabled 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/undefined/repos/undefined/settings/pull-requests",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path repoForceRebase() return false if squash strategy is enabled 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/undefined/repos/undefined/settings/pull-requests",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path repoForceRebase() return true if ff-only strategy is enabled 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/undefined/repos/undefined/settings/pull-requests",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path repoForceRebase() return true if rebase-ff-only strategy is enabled 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/undefined/repos/undefined/settings/pull-requests",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path repoForceRebase() return true if squash-ff-only strategy is enabled 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/undefined/repos/undefined/settings/pull-requests",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path repoForceRebase() returns false on missing defaultStrategy 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/undefined/repos/undefined/settings/pull-requests",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path repoForceRebase() returns false on missing mergeConfig 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/undefined/repos/undefined/settings/pull-requests",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path setBranchStatus() should be success 1 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
  Object {
    "body": Object {
      "description": null,
      "key": "context-2",
      "state": "SUCCESSFUL",
      "url": "https://renovatebot.com",
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "91",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/vcs/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/build-status/1.0/commits/stats/0d9c7726c3d628b7e28af234595cfd20febdbf8e",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path setBranchStatus() should be success 2 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
  Object {
    "body": Object {
      "description": null,
      "key": "context-2",
      "state": "FAILED",
      "url": "https://renovatebot.com",
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "87",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/vcs/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/build-status/1.0/commits/stats/0d9c7726c3d628b7e28af234595cfd20febdbf8e",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path setBranchStatus() should be success 3 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
  Object {
    "body": Object {
      "description": null,
      "key": "context-2",
      "state": "FAILED",
      "url": "https://renovatebot.com",
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "87",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/vcs/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/build-status/1.0/commits/stats/0d9c7726c3d628b7e28af234595cfd20febdbf8e",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path setBranchStatus() should be success 4 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
  Object {
    "body": Object {
      "description": null,
      "key": "context-2",
      "state": "INPROGRESS",
      "url": "https://renovatebot.com",
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "91",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/vcs/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/build-status/1.0/commits/stats/0d9c7726c3d628b7e28af234595cfd20febdbf8e",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path setBranchStatus() should be success 5 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
  Object {
    "body": Object {
      "description": null,
      "key": "context-2",
      "state": "SUCCESSFUL",
      "url": "https://renovatebot.com",
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "91",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/vcs/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path setBranchStatus() should be success 6 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/build-status/1.0/commits/0d9c7726c3d628b7e28af234595cfd20febdbf8e?limit=100",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path updatePr() closes PR 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "body": Object {
      "description": "body",
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "userName2",
          },
        },
      ],
      "title": "title",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "94",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/decline?version=42",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path updatePr() handles invalid users gracefully by retrying without invalid reviewers 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "body": Object {
      "description": "body",
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "userName2",
          },
        },
      ],
      "title": "title",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "94",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "body": Object {
      "description": "body",
      "reviewers": Array [],
      "title": "title",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "65",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path updatePr() puts PR 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "body": Object {
      "description": "body",
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "userName2",
          },
        },
      ],
      "title": "title",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "94",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path updatePr() re-opens PR 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "body": Object {
      "description": "body",
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "userName2",
          },
        },
      ],
      "title": "title",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "94",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "POST",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5/reopen?version=42",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path updatePr() throws 1`] = `"Response code 405 (Method Not Allowed)"`;

exports[`modules/platform/bitbucket-server/index endpoint with path updatePr() throws 2`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "body": Object {
      "description": "body",
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "userName2",
          },
        },
      ],
      "title": "title",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "94",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path updatePr() throws not-found 1 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path updatePr() throws not-found 2 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/4",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path updatePr() throws not-found 3 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "body": Object {
      "description": "body",
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "userName2",
          },
        },
      ],
      "title": "title",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "94",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;

exports[`modules/platform/bitbucket-server/index endpoint with path updatePr() throws repository-changed 1`] = `
Array [
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/branches/default",
  },
  Object {
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "GET",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
  Object {
    "body": Object {
      "description": "body",
      "reviewers": Array [
        Object {
          "user": Object {
            "name": "userName2",
          },
        },
      ],
      "title": "title",
      "version": 1,
    },
    "headers": Object {
      "accept": "application/json",
      "accept-encoding": "gzip, deflate, br",
      "authorization": "Basic YWJjOjEyMw==",
      "content-length": "94",
      "content-type": "application/json",
      "host": "stash.renovatebot.com",
      "user-agent": "RenovateBot/0.0.0-semantic-release (https://github.com/renovatebot/renovate)",
      "x-atlassian-token": "no-check",
    },
    "method": "PUT",
    "url": "https://stash.renovatebot.com/vcs/rest/api/1.0/projects/SOME/repos/repo/pull-requests/5",
  },
]
`;
